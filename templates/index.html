<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>r/howRUfeeling?</title>
  <style>
    :root {
      --bg-dark: #2e2e2e;
      --box-dark: #1a1a1a;
      --text-light: #f0f0f0;
      --accent: #CC0033; /* rutgers red */
      --positive: #4caf50;
      --negative: #e53935;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-light);
      margin: 0;
      padding: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      color: var(--accent);
      margin-bottom: 10px;
      padding: 1px 50px;
    }

    p {
      margin-top: 0;
      margin-bottom: 20px;
    }

    .containerSearch {
      background-color: var(--box-dark);
      padding: 25px 40px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      text-align: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .containerSearch:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 14px rgba(0,0,0,0.6);
    }

    input[type="text"] {
      padding: 10px 14px;
      border: none;
      border-radius: 6px;
      width: 250px;
      outline: none;
      background-color: #333;
      color: white;
    }

    input::placeholder {
      color: #aaa;
    }

    button {
      padding: 10px 16px;
      margin-left: 8px;
      border: none;
      border-radius: 6px;
      background-color: var(--accent);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #64c0ff;
    }

    #loading {
      margin-top: 15px;
      color: #bbb;
      font-style: italic;
    }

    #results {
      background-color: var(--box-dark);
      padding: 25px 35px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      width: 80%;
      max-width: 700px;
      margin-top: 30px;
      display: none;
    }

    .review {
      border-bottom: 1px solid #444;
      padding: 10px 0;
    }

    .review:last-child {
      border-bottom: none;
    }

    .positive { color: var(--positive); }
    .negative { color: var(--negative); }

    h2, h3 {
      color: var(--accent);
    }
  </style>
</head>
<body>
  <div class="containerSearch">
    <h1>r/howRUfeeling?</h1>
    <p>Enter a topic to see what r/Rutgers thinks.</p>

    <input type="text" id="profName" placeholder="e.g., &quot;David Menendez&quot; or &quot;REXB&quot;">
    <button id="analyzeBtn">Analyze</button>
    <div id="loading" style="display:none;">Analyzing... please wait.</div>
  </div>

  <div id="results"></div>

  <script>
    const toFive = p => Math.max(-5, Math.min(5, p * 5));

    document.getElementById('analyzeBtn').addEventListener('click', async () => {
      const profName = document.getElementById('profName').value.trim();
      if (!profName) return alert("Please enter a professor name.");

      const loading = document.getElementById('loading');
      const results = document.getElementById('results');
      loading.style.display = 'block';
      results.style.display = 'none';
      results.innerHTML = '';

      const response = await fetch('/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prof_name: profName })
      });

      loading.style.display = 'none';

      if (!response.ok) {
        const error = await response.json();
        results.innerHTML = `<p style="color:red;">Error: ${error.error}</p>`;
        results.style.display = 'block';
        return;
      }

      const data = await response.json();

      // Build results HTML
      let html = `<h2>Summary for "${profName}"</h2>`;
      html += `<p><b>Common Themes:</b> ${data.summary}</p>`;
      html += `<p><b>Average Polarity:</b> ${toFive(data.average_polarity).toFixed(2)}</p>`;
      html += "<h3>Top Reviews:</h3>";

      data.sentiments.forEach(r => {
        const sentimentClass = r.polarity > 0.3 ? 'positive' : (r.polarity < -0.3 ? 'negative' : '');
        const pol5 = toFive(r.polarity);
        html += `
          <div class="review ${sentimentClass}">
            <p>${r.review}</p>
            <p>Polarity: ${pol5.toFixed(2)}, Subjectivity: ${r.subjectivity.toFixed(2)}</p>
          </div>`;
      });

      results.innerHTML = html;
      results.style.display = 'block';
    });
  </script>
</body>
</html>
